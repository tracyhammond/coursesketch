<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utilities/templates/schoolItem/schoolItemBuilder.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utilities/templates/schoolItem/schoolItemBuilder.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Takes in a school item object (which is a course, assignment ... etc) and
 * creates an item card as a result.
 */
function SchoolItemBuilder() {
    /**
     * resets the values in the school builder so that the same build object can
     * be used again.
     *
     * NOTE: ONLY DATA SHOULD GO HERE.
     */
    this.resetValues = function resetValues() {
        this.list = 0;
        this.instructorCard = false; // true if the card is for an instructor
        // and will be editable as such

        // items to show
        this.listTitle = false; // true if we want to show the title
        this.showImage = true; // true if we want to show an image
        this.showBox = true; // if we want the card to be boxed shape
        this.showDescription = true; // true to show the description
        this.showState = true; // changed from this.showCompletionStatus
        this.showDate = true; // true to show the date.

        this.clearList = true; // true if you want to empty the previous list.

        // function
        this.boxClickFunction = false; // calls a function with the entire
        // schoolItem object
        this.editCallback = false; // when in instructor mode this can be
        // used to edit the box. and the item is
        // saved

        // custom text for an empty list.
        this.emptyListMessage = false;
    };

    this.resetValues();

    /***************************************************************************
     * NOTHING ELSE GOES ABOVE THIS!!!!! SETTER METHODS
     *
     * Creates a set method for every variable in the current object. EX:
     * setWidth, setImageClicked ...
     **************************************************************************/
    for (var obj in this) {
        if (obj !== this.resetValues &amp;&amp; ('' + obj) !== 'resetValues') {
            var objectName = '' + obj;
            // scopes the loop so that the memory of the object stays
            (function(objectName, scope) {
                // capitalizes only the first letter.
                var capitalName = objectName.charAt(0).toUpperCase() + objectName.slice(1);
                var setName = 'set' + capitalName;
                scope[setName] = function(value) {
                    scope[objectName] = value;
                    return scope;
                };
            })(objectName, this);
        }
    }

    /***************************************************************************
     * LOCAL VARIABLES
     **************************************************************************/
    var COURSE = 'Course';
    var ASSIGNMENT = 'Assignment';
    var PROBLEM = 'Problem';
    var BANK_PROBLEM = 'BankProblem';
    var LECTURE = 'BankProblem';

    /***************************************************************************
     * CREATING LIST LOGIC
     **************************************************************************/

    this.build = function(id) {

        var hostElement = undefined;
        if (typeof id === 'string') {
            hostElement = document.getElementById(id);
        } else {
            hostElement = id;
        }

        if (this.clearList) {
            // TODO: make this use the faster way of clearing
            hostElement.innerHTML = '';
        }

        var element = document.createElement('h1');
        // if there is no list add the empty message and then exit
        if (!this.list || this.list.length &lt;= 0) {
            var message = 'There are no items in this list!';
            if (this.emptyListMessage) {
                message = '' + this.emptyListMessage;
            }
            element.textContent = message;
            hostElement.appendChild(element);
            return;
        }

        // adds a title
        if (this.listTitle) {
            element.textContent = this.listTitle;
            hostElement.appendChild(element);
        }

        this.createSchoolList(hostElement);
    };

    /**
     * Creates a list of school items with the parameters set by the builder.
     */
    this.createSchoolList = function(parentElement) {
        // only get the date once.
        var currentDate = CourseSketch.getCurrentTime();

        for (var i = 0; i &lt; this.list.length; i++) {
            var srlSchoolItem = this.list[i];
            var type = findType(srlSchoolItem); // We establish the type of this
            // specific card

            parentElement.appendChild(this.createFancySchoolItem(srlSchoolItem, currentDate, type, i));
        }
    };

    /**
     * Returns a string of the object's type (SrlCourse, SrlAssignment, or
     * SrlProblem
     */
    function findType(object) {
        if (!isUndefined(object.assignmentList)) {
            return COURSE;
        } else if (!isUndefined(object.problemList)) {
            return ASSIGNMENT;
        } else if (!isUndefined(object.problemInfo)) {
            return PROBLEM;
        } else if (!isUndefined(object.questionText)) {
            return BANK_PROBLEM;
        } else {
            return LECTURE;
        }
    }

    /**
     * Builds up a school item that is fully customizable
     */
    this.createFancySchoolItem = function createFancySchoolItem(srlSchoolItem, currentDate, type, index) {
        // Required Items
        var box = document.createElement('school-item');
        box.setAttribute('id', srlSchoolItem.id);
        box.schoolItemData = srlSchoolItem;

        // every box starts off not being edtited
        box.dataset.isediting = false;

        if (!this.instructorCard &amp;&amp; this.boxClickFunction) {
            box.dataset.clickable = '';
        }

        if (this.instructorCard) {
            box.dataset.instructor = '';
        }

        box.setAttribute('data-item_number', index);

        this.addClickFunction(box, this.boxClickFunction, this.editCallback, srlSchoolItem);

        this.setBoxState(box, srlSchoolItem);

        // add the text component
        this.writeTextData(box, srlSchoolItem, currentDate, type);

        return box;
    };

    /**
     * Sets the state if it exist and if showState is true.
     */
    this.setBoxState = function(box, srlSchoolItem) {
        if (!this.showState) {
            return;
        }
        var itemState = srlSchoolItem.state;
        if (itemState !== null &amp;&amp; !isUndefined(itemState)) {
            // TODO: add state for an assignment that has been graded.
            if (itemState.graded) {
                $(box).addClass('graded');
                box.dataset.state = 'graded';
            } else if (!itemState.accessible &amp;&amp; itemState.pastDue) {
                $(box).addClass('closed');
                box.dataset.state = 'closed';
            } else if (itemState.completed) {
                box.dataset.state = 'completed';
            } else if (itemState.started) {
                box.dataset.state = 'inProgress';
            } else if (!itemState.accessible) {
                box.dataset.state = 'notOpen';
            }
        }
    };

    /**
     * Adds an onclick function to the element if the function exists, does
     * nothing otherwise.
     */
    this.addClickFunction = function addClickFunction(element, boxFunction, editFunction) {
        if (boxFunction) {
            element.addEventListener('click', function() {
                if (element.dataset.isediting === 'false') {
                    boxFunction.bind(element)(element.schoolItemData);
                }
            }, false);
            // GET THE ONCLICK LISTENTER TO DO THE CLICKING THING CORRECTLY!
        }

        if (editFunction) {
            element.setEditCallback(function(type, oldValue, newValue, realElement) {
                editFunction(type, oldValue, newValue, realElement.schoolItemData);
            });
        }
    };

    /**
     * Writes out the data that composes the text portion of the box.
     * (Title,subTitle, date, description)
     */
    this.writeTextData = function writeTextData(box, srlSchoolItem, currentDate, type) {

        if (srlSchoolItem.name) {
            var name = document.createElement('span');
            name.className = 'name';
            name.textContent = srlSchoolItem.name;
            box.appendChild(name);
        }

        var description = document.createElement('div');
        if (srlSchoolItem.description) {
            description.className = 'description';
            description.textContent = srlSchoolItem.description;
            box.appendChild(description);
        } else if (type === PROBLEM &amp;&amp; srlSchoolItem.problemInfo) {
            description.className = 'description';
            description.textContent = srlSchoolItem.getProblemInfo().getQuestionText();
            box.appendChild(description);
        }  else if (type === BANK_PROBLEM &amp;&amp; srlSchoolItem.questionText) {
            description.className = 'description';
            description.textContent = srlSchoolItem.getQuestionText();
            box.appendChild(description);
        }

        if (type === ASSIGNMENT &amp;&amp; this.showDate) {
            this.showFormattedDate(box, srlSchoolItem, currentDate, type);
        }
    };

    /**
     * Creates the formatted date that appears on cards. These only appear if
     * the date object exist.
     */
    this.showFormattedDate = function(box, srlSchoolItem, currentDate, type) {

        // TODO: show the earliest date that has not happened.
        // I.E if it has not opened yet show that date and the due date
        // if the due date has passed show the close date
        // if the close date has passed show only the close date

        var accessDate = srlSchoolItem.accessDate;
        var element;
        if (accessDate) {
            element = document.createElement('span');
            element.setAttribute('class', 'accessDate');
            element.textContent = getFormattedDateTime(new Date(accessDate.millisecond.toNumber()));
            box.appendChild(element);
        }

        var dueDate = srlSchoolItem.dueDate;
        if (dueDate) {
            element = document.createElement('span');
            element.setAttribute('class', 'dueDate');
            element.textContent = getFormattedDateTime(new Date(dueDate.millisecond.toNumber()));
            box.appendChild(element);
        }

        var closeDate = srlSchoolItem.closeDate;
        var showCloseDate = true;
        if (dueDate &amp;&amp; closeDate) {
            showCloseDate = closeDate.millisecond.toNumber() !== dueDate.millisecond.toNumber();
        }
        if (closeDate &amp;&amp; showCloseDate) {
            element = document.createElement('span');
            element.setAttribute('class', 'closeDate');
            element.textContent = getFormattedDateTime(new Date(closeDate.millisecond.toNumber()));
            box.appendChild(element);
        }

        // if there is a single date element involved.
        if (accessDate || dueDate || (closeDate &amp;&amp; showCloseDate)) {
            $(box).addClass('validDate');
        }
    };
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseException.html">BaseException</a></li><li><a href="CommandException.html">CommandException</a></li><li><a href="DatabaseException.html">DatabaseException</a></li><li><a href="Graphics.html">Graphics</a></li><li><a href="LoginSystem.html">LoginSystem</a></li><li><a href="NavigationPanel.html">NavigationPanel</a></li><li><a href="ProblemNavigator.html">ProblemNavigator</a></li><li><a href="ProtobufSetup.html">ProtobufSetup</a></li><li><a href="ProtoDatabase.html">ProtoDatabase</a></li><li><a href="Redirector.html">Redirector</a></li><li><a href="RegisterSystem.html">RegisterSystem</a></li><li><a href="SchoolDataManager.html">SchoolDataManager</a></li><li><a href="SchoolItem.html">SchoolItem</a></li><li><a href="SketchSurface.html">SketchSurface</a></li><li><a href="UndoRedoException.html">UndoRedoException</a></li><li><a href="UpdateException.html">UpdateException</a></li><li><a href="UpdateManager.html">UpdateManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAnswer">addAnswer</a></li><li><a href="global.html#addAnswerContent">addAnswerContent</a></li><li><a href="global.html#addCallback">addCallback</a></li><li><a href="global.html#addClickFunction">addClickFunction</a></li><li><a href="global.html#addEventMapping">addEventMapping</a></li><li><a href="global.html#addSynchronousUpdate">addSynchronousUpdate</a></li><li><a href="global.html#addToolArea">addToolArea</a></li><li><a href="global.html#addUpdate">addUpdate</a></li><li><a href="global.html#AdvanceDataListener">AdvanceDataListener</a></li><li><a href="global.html#ArrayException">ArrayException</a></li><li><a href="global.html#assignValues">assignValues</a></li><li><a href="global.html#build">build</a></li><li><a href="global.html#buildExpandEvent">buildExpandEvent</a></li><li><a href="global.html#buildOverlay">buildOverlay</a></li><li><a href="global.html#buildPercent">buildPercent</a></li><li><a href="global.html#buildWaitIcon">buildWaitIcon</a></li><li><a href="global.html#CallbackBarrier">CallbackBarrier</a></li><li><a href="global.html#checkOverflow">checkOverflow</a></li><li><a href="global.html#clearCallbacks">clearCallbacks</a></li><li><a href="global.html#clearUpdates">clearUpdates</a></li><li><a href="global.html#close">close</a></li><li><a href="global.html#Connection">Connection</a></li><li><a href="global.html#continueButton">continueButton</a></li><li><a href="global.html#correctSize">correctSize</a></li><li><a href="global.html#CourseSketch">CourseSketch</a></li><li><a href="global.html#createBarrier">createBarrier</a></li><li><a href="global.html#createButton">createButton</a></li><li><a href="global.html#createFancySchoolItem">createFancySchoolItem</a></li><li><a href="global.html#createMarker">createMarker</a></li><li><a href="global.html#createNewPath">createNewPath</a></li><li><a href="global.html#createSchoolList">createSchoolList</a></li><li><a href="global.html#createSketch">createSketch</a></li><li><a href="global.html#createTable">createTable</a></li><li><a href="global.html#deleteSketch">deleteSketch</a></li><li><a href="global.html#detachedCallback">detachedCallback</a></li><li><a href="global.html#EmbeddedHtml">EmbeddedHtml</a></li><li><a href="global.html#emptyQueue">emptyQueue</a></li><li><a href="global.html#endPath">endPath</a></li><li><a href="global.html#executeEvent">executeEvent</a></li><li><a href="global.html#fillCanvas">fillCanvas</a></li><li><a href="global.html#finalize">finalize</a></li><li><a href="global.html#getCleanUpdateList">getCleanUpdateList</a></li><li><a href="global.html#getConnection">getConnection</a></li><li><a href="global.html#getCurrentAssignment">getCurrentAssignment</a></li><li><a href="global.html#getCurrentNumber">getCurrentNumber</a></li><li><a href="global.html#getCurrentProblemId">getCurrentProblemId</a></li><li><a href="global.html#getCurrentSketch">getCurrentSketch</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getCurrentUpdate">getCurrentUpdate</a></li><li><a href="global.html#getFinishedCallback">getFinishedCallback</a></li><li><a href="global.html#getHostElement">getHostElement</a></li><li><a href="global.html#getLength">getLength</a></li><li><a href="global.html#getListLength">getListLength</a></li><li><a href="global.html#getPaper">getPaper</a></li><li><a href="global.html#getProblemText">getProblemText</a></li><li><a href="global.html#getProblemType">getProblemType</a></li><li><a href="global.html#getSketch">getSketch</a></li><li><a href="global.html#getSupportedEnums">getSupportedEnums</a></li><li><a href="global.html#getSupportedObjects">getSupportedObjects</a></li><li><a href="global.html#getUpdateList">getUpdateList</a></li><li><a href="global.html#GivenanSrlUpdateaRequestiscreated.">Given an SrlUpdate a Request is created.</a></li><li><a href="global.html#gotoNext">gotoNext</a></li><li><a href="global.html#goToNextSlide">goToNextSlide</a></li><li><a href="global.html#gotoPrevious">gotoPrevious</a></li><li><a href="global.html#goToProblem">goToProblem</a></li><li><a href="global.html#hasNext">hasNext</a></li><li><a href="global.html#hasPrevious">hasPrevious</a></li><li><a href="global.html#HighlightText">HighlightText</a></li><li><a href="global.html#ImageBox">ImageBox</a></li><li><a href="global.html#IndexManager">IndexManager</a></li><li><a href="global.html#Inheritssetsupinheritanceforfunctionsthis.Inherits(SuperClass);//supercallinsideobjectANDSubClass.Inherits(SuperClass);">Inherits
sets up inheritance for functions

this.Inherits(SuperClass); // super call inside object AND
SubClass.Inherits(SuperClass);</a></li><li><a href="global.html#initializeCanvas">initializeCanvas</a></li><li><a href="global.html#initializeElement">initializeElement</a></li><li><a href="global.html#InputListener">InputListener</a></li><li><a href="global.html#isConnected">isConnected</a></li><li><a href="global.html#isDataLoaded">isDataLoaded</a></li><li><a href="global.html#isDescriptionOverflow">isDescriptionOverflow</a></li><li><a href="global.html#isLastUpdateSave">isLastUpdateSave</a></li><li><a href="global.html#isLastUpdateSubmission">isLastUpdateSubmission</a></li><li><a href="global.html#isValidForSaving">isValidForSaving</a></li><li><a href="global.html#isValidForSubmission">isValidForSubmission</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadLectures">loadLectures</a></li><li><a href="global.html#loadSketch">loadSketch</a></li><li><a href="global.html#loadSlides">loadSlides</a></li><li><a href="global.html#MultiChoice">MultiChoice</a></li><li><a href="global.html#Playback">Playback</a></li><li><a href="global.html#ProblemToolBar">ProblemToolBar</a></li><li><a href="global.html#Question">Question</a></li><li><a href="global.html#reconnect">reconnect</a></li><li><a href="global.html#redoAction">redoAction</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#reloadAssignment">reloadAssignment</a></li><li><a href="global.html#reloadProblems">reloadProblems</a></li><li><a href="global.html#removeAnswer">removeAnswer</a></li><li><a href="global.html#removeCallback">removeCallback</a></li><li><a href="global.html#removeEventMapping">removeEventMapping</a></li><li><a href="global.html#removeItem">removeItem</a></li><li><a href="global.html#removeListener">removeListener</a></li><li><a href="global.html#resetValues">resetValues</a></li><li><a href="global.html">runCommand
Runs a specific command given its lastUpdateType.</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#SchoolItemBuilder">SchoolItemBuilder</a></li><li><a href="global.html#sendlocalScope">sendlocalScope</a></li><li><a href="global.html#sendRequest">sendRequest</a></li><li><a href="global.html#setAssignmentId">setAssignmentId</a></li><li><a href="global.html#setBoxState">setBoxState</a></li><li><a href="global.html#setCancelCallbackThecallbackiscalledwhentheregisterbuttonispressed.">setCancelCallback
The callback is called when the register button is pressed.</a></li><li><a href="global.html#setCorrectAnswer">setCorrectAnswer</a></li><li><a href="global.html#setCurrentSketch">setCurrentSketch</a></li><li><a href="global.html#setDrawUpdate">setDrawUpdate</a></li><li><a href="global.html#setEditCallback">setEditCallback</a></li><li><a href="global.html#setLastSaveTime">setLastSaveTime</a></li><li><a href="global.html#setListener">setListener</a></li><li><a href="global.html#setListeners">setListeners</a></li><li><a href="global.html#setOnSuccessLoginThecallbackiscalledwithoneparameter.">setOnSuccessLogin
The callback is called with one parameter.</a></li><li><a href="global.html#setParentSketch">setParentSketch</a></li><li><a href="global.html#setParentSketchId">setParentSketchId</a></li><li><a href="global.html#setPreferredIndex">setPreferredIndex</a></li><li><a href="global.html#setPreviewText">setPreviewText</a></li><li><a href="global.html#setRedoCallback">setRedoCallback</a></li><li><a href="global.html#setRegisterCallbackThecallbackiscalledwhentheregisterbuttonispressed.">setRegisterCallback
The callback is called when the register button is pressed.</a></li><li><a href="global.html#setRemoveFunction">setRemoveFunction</a></li><li><a href="global.html#setSaveCallback">setSaveCallback</a></li><li><a href="global.html#setSketch">setSketch</a></li><li><a href="global.html#setSketchClickedFunction">setSketchClickedFunction</a></li><li><a href="global.html#setSketchManager">setSketchManager</a></li><li><a href="global.html#setSubmissionInformation">setSubmissionInformation</a></li><li><a href="global.html#setSubmitCallback">setSubmitCallback</a></li><li><a href="global.html#setUiLoaded">setUiLoaded</a></li><li><a href="global.html#setUndoCallback">setUndoCallback</a></li><li><a href="global.html#setupAttributes">setupAttributes</a></li><li><a href="global.html#setupCallbacksSetupsupthecallbackfortheregisterbuttonandthelostpasswordbutton.">setupCallbacks
Setups up the callback for the register button and the lost password button.</a></li><li><a href="global.html#setUpdateList">setUpdateList</a></li><li><a href="global.html#setUpdateTime">setUpdateTime</a></li><li><a href="global.html#setUpEditButtons">setUpEditButtons</a></li><li><a href="global.html#setWrapperFunction">setWrapperFunction</a></li><li><a href="global.html#showFormattedDate">showFormattedDate</a></li><li><a href="global.html#SketchSurfaceManager">SketchSurfaceManager</a></li><li><a href="global.html#speakText">speakText</a></li><li><a href="global.html#SubmissionPanel">SubmissionPanel</a></li><li><a href="global.html#TextBox">TextBox</a></li><li><a href="global.html#TimelineMarker">TimelineMarker</a></li><li><a href="global.html#toggleSelection">toggleSelection</a></li><li><a href="global.html#undoAction">undoAction</a></li><li><a href="global.html#updatePath">updatePath</a></li><li><a href="global.html#writeTextData">writeTextData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta2</a> on Fri Mar 13 2015 04:13:07 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
