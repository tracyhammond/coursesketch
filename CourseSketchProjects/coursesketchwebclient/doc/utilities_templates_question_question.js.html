<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utilities/templates/question/question.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utilities/templates/question/question.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Represents a custom question element that can have data saved/loaded to/from protobuf.
 */
function Question() {
    this.lectures = [];

    /**
     * @param {Node} templateClone is a clone of the custom HTML Element for the text box
     * Makes the exit button close the box and enables dragging
     */
    this.initializeElement = function(templateClone) {
        localScope = this; // This sets the variable to the level of the custom element tag
        shadowRoot = this.createShadowRoot();
        shadowRoot.appendChild(templateClone);

        shadowRoot.getElementById('actions').onclick = function(event) {
            shadowRoot.getElementById('actions-dialog').open = true;
        };
        shadowRoot.getElementById('dialog-close').onclick = function(event) {
            shadowRoot.getElementById('actions-dialog').open = false;
        };
        shadowRoot.getElementById('correct-lecture').onchange = function(event) {
            var value = event.srcElement.value;
            var lectureIndex = parseInt(event.srcElement.dataset['lecture-' + value], 10);
            var lecture = localScope.lectures[lectureIndex];
            localScope.loadSlides(lecture.idList, shadowRoot.getElementById('correct-slide'));
        };
        shadowRoot.getElementById('incorrect-lecture').onchange = function(event) {
            var value = event.srcElement.value;
            var lectureIndex = parseInt(event.srcElement.dataset['lecture-' + value], 10);
            var lecture = localScope.lectures[lectureIndex];
            localScope.loadSlides(lecture.idList, shadowRoot.getElementById('incorrect-slide'));
        };
    };

    /**
     * Loads the lectures that can be navigated to in the question.
     * @param {String} lectureIds list of lecture IDs to load
     */
    this.loadLectures = function(lectureIds) {
        var localScope = this;
        var callback = function(lectures) {
            shadowRoot.getElementById('correct-lecture').innerHTML = '';
            shadowRoot.getElementById('incorrect-lecture').innerHTML = '';
            shadowRoot.getElementById('correct-lecture').dataset = [];
            shadowRoot.getElementById('incorrect-lecture').dataset = [];
            localScope.lectures = [];
            for (var i = 0; i &lt; lectures.length; ++i) {
                var option = document.createElement('option');
                option.textContent = lectures[i].name;
                option.value = lectures[i].id;
                shadowRoot.getElementById('correct-lecture').dataset['lecture-' + lectures[i].id] = i;
                shadowRoot.getElementById('incorrect-lecture').dataset['lecture-' + lectures[i].id] = i;
                localScope.lectures.push(lectures[i]);
                shadowRoot.getElementById('correct-lecture').appendChild(option);
                shadowRoot.getElementById('incorrect-lecture').appendChild(option.cloneNode(true));
            }
            if (localScope.lectures.length > 0) {
                localScope.loadSlides(localScope.lectures[0].idList, shadowRoot.getElementById('correct-slide'));
                localScope.loadSlides(localScope.lectures[0].idList, shadowRoot.getElementById('incorrect-slide'));
            }
            $(localScope.shadowRoot.getElementById('actions-box')).removeClass('hide');
        };
        CourseSketch.dataManager.getCourseLectures(lectureIds, callback, callback);
    };

    /**
     * Loads slides into a slide select element.
     * @param {List&lt;String>} idList list of 'idsInLecture' containing the slides to load
     * @param {Element} slideSelect select element to load the slides into
     */
    this.loadSlides = function(idList, slideSelect) {
        var callback = function(slides) {
            slideSelect.innerHTML = '';
            for (var i = 0; i &lt; slides.length; ++i) {
                var option = document.createElement('option');
                option.textContent = i + 1;
                option.value = i;
                slideSelect.appendChild(option);
            }
            if (slides.length > 0) {
                slideSelect.disabled = false;
            }
        };
        var slideIds = [];
        for (var i = 0; i &lt; idList.length; ++i) {
            slideIds.push(idList[i].id);
        }
        CourseSketch.dataManager.getLectureSlides(slideIds, callback, callback);
    };

    /**
     * Adds multiple choice content to the question
     * @param {Element} answerContent the MultiChoice element to add
     */
    this.addAnswerContent = function(answerContent) {
        answerContent.className = 'answer';
        this.appendChild(answerContent);
    };

    /**
     * Saves the embedded HTML element to a protobuf object. Calls finished callback when done.
     *
     * @param {Event} event event that triggered this function
     * @return {SrlQuestion} the created protobuf object.
     */
    this.saveData = function(event) {
        var questionProto = CourseSketch.PROTOBUF_UTIL.SrlQuestion();

        // Populate data in the proto object
        questionProto.id = generateUUID();
        questionProto.setQuestionText(this.shadowRoot.querySelector('#text').value);
        var nodes = this.shadowRoot.querySelector('content').getDistributedNodes();
        // We should really only ever have one node here
        if (nodes.length > 0) {
            if (nodes[0] instanceof MultiChoice) {
                questionProto.multipleChoice = nodes[0].saveData();
            } else if (nodes[0] instanceof SketchSurface) {
                // TODO: Need to support sketch questions
                // questionProto.ourThing = nodes[0].saveData();
                console.log('Saving sketch questions is not yet supported.');
            } else {
                throw 'Attempted to save invalid answer element';
            }
        }

        // TODO: Currently just one nav for correct/incorrect; add navs for different answer choices (also needs to work with sketch)
        // TODO: Add validation; currently if the user forgets to specify this, defaults to first lecture and first slide
        var correctLecture = shadowRoot.getElementById('correct-lecture');
        var correctSlide = shadowRoot.getElementById('correct-slide');
        var incorrectLecture = shadowRoot.getElementById('incorrect-lecture');
        var incorrectSlide = shadowRoot.getElementById('incorrect-slide');
        if (!isUndefined(correctLecture) &amp;&amp; !isUndefined(correctSlide) &amp;&amp; !isUndefined(incorrectLecture) &amp;&amp; !isUndefined(incorrectSlide) &amp;&amp;
                correctLecture !== null &amp;&amp; correctSlide !== null &amp;&amp; incorrectLecture !== null &amp;&amp; incorrectSlide !== null) {
            var correctLectureId = correctLecture.value;
            var correctSlideStr = correctSlide.value;
            var incorrectLectureId = incorrectLecture.value;
            var incorrectSlideStr = incorrectSlide.value;
            if (!isUndefined(correctLectureId) &amp;&amp; !isUndefined(correctSlideStr) &amp;&amp; !isUndefined(incorrectLectureId) &amp;&amp;
                    !isUndefined(incorrectSlideStr) &amp;&amp; correctLectureId !== '' &amp;&amp; correctSlideStr !== '' &amp;&amp; incorrectLectureId !== '' &amp;&amp;
                    incorrectSlideStr !== '') {
                var correctNav = CourseSketch.PROTOBUF_UTIL.LectureNavigator();
                var incorrectNav = CourseSketch.PROTOBUF_UTIL.LectureNavigator();
                correctNav.nextLectureId = correctLectureId;
                correctNav.nextSlide = parseInt(correctSlideStr, 10);
                incorrectNav.nextLectureId = incorrectLectureId;
                incorrectNav.nextSlide = parseInt(incorrectSlideStr, 10);
                questionProto.navs[0] = correctNav;
                questionProto.navs[1] = incorrectNav;
            }
        }

        // If the textbox does not have an id, then a command has not been created for the question
        if ((isUndefined(this.id) || this.id === null || this.id === '')) {
            this.command = CourseSketch.PROTOBUF_UTIL.createBaseCommand(CourseSketch.PROTOBUF_UTIL.CommandType.CREATE_QUESTION, true);
        }
        this.command.setCommandData(questionProto.toArrayBuffer()); // Sets commandData for commandlist
        this.createdCommand = this.command;
        this.id = this.command.commandId;
        var callback = this.getFinishedCallback();
        if (!isUndefined(callback)) {
            callback(this.command, event, this.currentUpdate); // Gets finishedCallback and calls it with command as parameter
        }
        return questionProto;
    };

    /**
     * @param {ProtoCommand} questionProto is the data to be loaded from the proto
     * If shadowRoot does not exist, saves the protoCommand locally and returns so the element can be initialized
     * If the protoCommand does not exist, returns because data cannot be loaded
     *
     * NOTE: If using navigation, this MUST be called after loadLectures has been called!
     */
    this.loadData = function(questionProto) {
        if (isUndefined(shadowRoot) || isUndefined(questionProto)) {
            return;
        }
        this.shadowRoot.querySelector('#text').value = questionProto.getQuestionText();
        var nodes = this.shadowRoot.querySelector('content').getDistributedNodes();
        if (!isUndefined(questionProto.multipleChoice) &amp;&amp; questionProto.multipleChoice !== null &amp;&amp; nodes.length > 0 &amp;&amp;
                (nodes[0] instanceof MultiChoice)) {
            var answerContent = nodes[0];
            answerContent.loadData(questionProto.multipleChoice);
        } else if (!isUndefined(questionProto.sketchQuestion) &amp;&amp; questionProto.sketchQuestion !== null) {
            throw 'Sketch questions are not yet supported';
        }

        // TODO: Currently just one nav for correct/incorrect; add navs for different answer choices (also needs to work with sketch)
        if (questionProto.navs.length >= 2) {
            var correctNav = questionProto.navs[0];
            var incorrectNav = questionProto.navs[1];
            shadowRoot.getElementById('correct-lecture').value = correctNav.nextLectureId;
            shadowRoot.getElementById('correct-slide').value = correctNav.nextSlide;
            shadowRoot.getElementById('incorrect-lecture').value = incorrectNav.nextLectureId;
            shadowRoot.getElementById('incorrect-slide').value = incorrectNav.nextSlide;
        }
    };

    /**
     * @return {Function} finishedCallback is the callback set at implementation.
     * The callback can be called immediately using .getFinishedCallback()(argument) with argument being optional
     */
    this.getFinishedCallback = function() {
        return this.finishedCallback;
    };

    this.setFinishedListener = function(listener) {
        this.finishedCallback = listener;
    };
}
Question.prototype = Object.create(HTMLDialogElement.prototype);
Question.prototype.finishedCallback = undefined; // Defined by whoever implements this by using setFinishedListener().
Question.prototype.createdCommand = undefined;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseException.html">BaseException</a></li><li><a href="CommandException.html">CommandException</a></li><li><a href="DatabaseException.html">DatabaseException</a></li><li><a href="Graphics.html">Graphics</a></li><li><a href="LoginSystem.html">LoginSystem</a></li><li><a href="NavigationPanel.html">NavigationPanel</a></li><li><a href="ProblemNavigator.html">ProblemNavigator</a></li><li><a href="ProtobufSetup.html">ProtobufSetup</a></li><li><a href="ProtoDatabase.html">ProtoDatabase</a></li><li><a href="Redirector.html">Redirector</a></li><li><a href="RegisterSystem.html">RegisterSystem</a></li><li><a href="SchoolDataManager.html">SchoolDataManager</a></li><li><a href="SchoolItem.html">SchoolItem</a></li><li><a href="SketchSurface.html">SketchSurface</a></li><li><a href="UndoRedoException.html">UndoRedoException</a></li><li><a href="UpdateException.html">UpdateException</a></li><li><a href="UpdateManager.html">UpdateManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAnswer">addAnswer</a></li><li><a href="global.html#addAnswerContent">addAnswerContent</a></li><li><a href="global.html#addCallback">addCallback</a></li><li><a href="global.html#addClickFunction">addClickFunction</a></li><li><a href="global.html#addEventMapping">addEventMapping</a></li><li><a href="global.html#addSynchronousUpdate">addSynchronousUpdate</a></li><li><a href="global.html#addToolArea">addToolArea</a></li><li><a href="global.html#addUpdate">addUpdate</a></li><li><a href="global.html#AdvanceDataListener">AdvanceDataListener</a></li><li><a href="global.html#ArrayException">ArrayException</a></li><li><a href="global.html#assignValues">assignValues</a></li><li><a href="global.html#build">build</a></li><li><a href="global.html#buildExpandEvent">buildExpandEvent</a></li><li><a href="global.html#buildOverlay">buildOverlay</a></li><li><a href="global.html#buildPercent">buildPercent</a></li><li><a href="global.html#buildWaitIcon">buildWaitIcon</a></li><li><a href="global.html#CallbackBarrier">CallbackBarrier</a></li><li><a href="global.html#checkOverflow">checkOverflow</a></li><li><a href="global.html#clearCallbacks">clearCallbacks</a></li><li><a href="global.html#clearUpdates">clearUpdates</a></li><li><a href="global.html#close">close</a></li><li><a href="global.html#Connection">Connection</a></li><li><a href="global.html#continueButton">continueButton</a></li><li><a href="global.html#correctSize">correctSize</a></li><li><a href="global.html#CourseSketch">CourseSketch</a></li><li><a href="global.html#createBarrier">createBarrier</a></li><li><a href="global.html#createButton">createButton</a></li><li><a href="global.html#createFancySchoolItem">createFancySchoolItem</a></li><li><a href="global.html#createMarker">createMarker</a></li><li><a href="global.html#createNewPath">createNewPath</a></li><li><a href="global.html#createSchoolList">createSchoolList</a></li><li><a href="global.html#createSketch">createSketch</a></li><li><a href="global.html#createTable">createTable</a></li><li><a href="global.html#deleteSketch">deleteSketch</a></li><li><a href="global.html#detachedCallback">detachedCallback</a></li><li><a href="global.html#EmbeddedHtml">EmbeddedHtml</a></li><li><a href="global.html#emptyQueue">emptyQueue</a></li><li><a href="global.html#endPath">endPath</a></li><li><a href="global.html#executeEvent">executeEvent</a></li><li><a href="global.html#fillCanvas">fillCanvas</a></li><li><a href="global.html#finalize">finalize</a></li><li><a href="global.html#getCleanUpdateList">getCleanUpdateList</a></li><li><a href="global.html#getConnection">getConnection</a></li><li><a href="global.html#getCurrentAssignment">getCurrentAssignment</a></li><li><a href="global.html#getCurrentNumber">getCurrentNumber</a></li><li><a href="global.html#getCurrentProblemId">getCurrentProblemId</a></li><li><a href="global.html#getCurrentSketch">getCurrentSketch</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getCurrentUpdate">getCurrentUpdate</a></li><li><a href="global.html#getFinishedCallback">getFinishedCallback</a></li><li><a href="global.html#getHostElement">getHostElement</a></li><li><a href="global.html#getLength">getLength</a></li><li><a href="global.html#getListLength">getListLength</a></li><li><a href="global.html#getPaper">getPaper</a></li><li><a href="global.html#getProblemText">getProblemText</a></li><li><a href="global.html#getProblemType">getProblemType</a></li><li><a href="global.html#getSketch">getSketch</a></li><li><a href="global.html#getSupportedEnums">getSupportedEnums</a></li><li><a href="global.html#getSupportedObjects">getSupportedObjects</a></li><li><a href="global.html#getUpdateList">getUpdateList</a></li><li><a href="global.html#GivenanSrlUpdateaRequestiscreated.">Given an SrlUpdate a Request is created.</a></li><li><a href="global.html#gotoNext">gotoNext</a></li><li><a href="global.html#goToNextSlide">goToNextSlide</a></li><li><a href="global.html#gotoPrevious">gotoPrevious</a></li><li><a href="global.html#goToProblem">goToProblem</a></li><li><a href="global.html#hasNext">hasNext</a></li><li><a href="global.html#hasPrevious">hasPrevious</a></li><li><a href="global.html#HighlightText">HighlightText</a></li><li><a href="global.html#ImageBox">ImageBox</a></li><li><a href="global.html#IndexManager">IndexManager</a></li><li><a href="global.html#Inheritssetsupinheritanceforfunctionsthis.Inherits(SuperClass);//supercallinsideobjectANDSubClass.Inherits(SuperClass);">Inherits
sets up inheritance for functions

this.Inherits(SuperClass); // super call inside object AND
SubClass.Inherits(SuperClass);</a></li><li><a href="global.html#initializeCanvas">initializeCanvas</a></li><li><a href="global.html#initializeElement">initializeElement</a></li><li><a href="global.html#InputListener">InputListener</a></li><li><a href="global.html#isConnected">isConnected</a></li><li><a href="global.html#isDataLoaded">isDataLoaded</a></li><li><a href="global.html#isDescriptionOverflow">isDescriptionOverflow</a></li><li><a href="global.html#isLastUpdateSave">isLastUpdateSave</a></li><li><a href="global.html#isLastUpdateSubmission">isLastUpdateSubmission</a></li><li><a href="global.html#isValidForSaving">isValidForSaving</a></li><li><a href="global.html#isValidForSubmission">isValidForSubmission</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadLectures">loadLectures</a></li><li><a href="global.html#loadSketch">loadSketch</a></li><li><a href="global.html#loadSlides">loadSlides</a></li><li><a href="global.html#MultiChoice">MultiChoice</a></li><li><a href="global.html#Playback">Playback</a></li><li><a href="global.html#ProblemToolBar">ProblemToolBar</a></li><li><a href="global.html#Question">Question</a></li><li><a href="global.html#reconnect">reconnect</a></li><li><a href="global.html#redoAction">redoAction</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#reloadAssignment">reloadAssignment</a></li><li><a href="global.html#reloadProblems">reloadProblems</a></li><li><a href="global.html#removeAnswer">removeAnswer</a></li><li><a href="global.html#removeCallback">removeCallback</a></li><li><a href="global.html#removeEventMapping">removeEventMapping</a></li><li><a href="global.html#removeItem">removeItem</a></li><li><a href="global.html#removeListener">removeListener</a></li><li><a href="global.html#resetValues">resetValues</a></li><li><a href="global.html">runCommand
Runs a specific command given its lastUpdateType.</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#SchoolItemBuilder">SchoolItemBuilder</a></li><li><a href="global.html#sendlocalScope">sendlocalScope</a></li><li><a href="global.html#sendRequest">sendRequest</a></li><li><a href="global.html#setAssignmentId">setAssignmentId</a></li><li><a href="global.html#setBoxState">setBoxState</a></li><li><a href="global.html#setCancelCallbackThecallbackiscalledwhentheregisterbuttonispressed.">setCancelCallback
The callback is called when the register button is pressed.</a></li><li><a href="global.html#setCorrectAnswer">setCorrectAnswer</a></li><li><a href="global.html#setCurrentSketch">setCurrentSketch</a></li><li><a href="global.html#setDrawUpdate">setDrawUpdate</a></li><li><a href="global.html#setEditCallback">setEditCallback</a></li><li><a href="global.html#setLastSaveTime">setLastSaveTime</a></li><li><a href="global.html#setListener">setListener</a></li><li><a href="global.html#setListeners">setListeners</a></li><li><a href="global.html#setOnSuccessLoginThecallbackiscalledwithoneparameter.">setOnSuccessLogin
The callback is called with one parameter.</a></li><li><a href="global.html#setParentSketch">setParentSketch</a></li><li><a href="global.html#setParentSketchId">setParentSketchId</a></li><li><a href="global.html#setPreferredIndex">setPreferredIndex</a></li><li><a href="global.html#setPreviewText">setPreviewText</a></li><li><a href="global.html#setRedoCallback">setRedoCallback</a></li><li><a href="global.html#setRegisterCallbackThecallbackiscalledwhentheregisterbuttonispressed.">setRegisterCallback
The callback is called when the register button is pressed.</a></li><li><a href="global.html#setRemoveFunction">setRemoveFunction</a></li><li><a href="global.html#setSaveCallback">setSaveCallback</a></li><li><a href="global.html#setSketch">setSketch</a></li><li><a href="global.html#setSketchClickedFunction">setSketchClickedFunction</a></li><li><a href="global.html#setSketchManager">setSketchManager</a></li><li><a href="global.html#setSubmissionInformation">setSubmissionInformation</a></li><li><a href="global.html#setSubmitCallback">setSubmitCallback</a></li><li><a href="global.html#setUiLoaded">setUiLoaded</a></li><li><a href="global.html#setUndoCallback">setUndoCallback</a></li><li><a href="global.html#setupAttributes">setupAttributes</a></li><li><a href="global.html#setupCallbacksSetupsupthecallbackfortheregisterbuttonandthelostpasswordbutton.">setupCallbacks
Setups up the callback for the register button and the lost password button.</a></li><li><a href="global.html#setUpdateList">setUpdateList</a></li><li><a href="global.html#setUpdateTime">setUpdateTime</a></li><li><a href="global.html#setUpEditButtons">setUpEditButtons</a></li><li><a href="global.html#setWrapperFunction">setWrapperFunction</a></li><li><a href="global.html#showFormattedDate">showFormattedDate</a></li><li><a href="global.html#SketchSurfaceManager">SketchSurfaceManager</a></li><li><a href="global.html#speakText">speakText</a></li><li><a href="global.html#SubmissionPanel">SubmissionPanel</a></li><li><a href="global.html#TextBox">TextBox</a></li><li><a href="global.html#TimelineMarker">TimelineMarker</a></li><li><a href="global.html#toggleSelection">toggleSelection</a></li><li><a href="global.html#undoAction">undoAction</a></li><li><a href="global.html#updatePath">updatePath</a></li><li><a href="global.html#writeTextData">writeTextData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta2</a> on Fri Mar 13 2015 04:13:07 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
