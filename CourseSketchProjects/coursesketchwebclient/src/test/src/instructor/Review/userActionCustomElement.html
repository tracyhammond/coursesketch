<html>
<head>
    <meta charset="UTF-8">
    <link rel="import" href="/src/instructor/review/userActionReviewInclude.html">
    <link rel="import" href="/src/sketching/sketchInclude.html">
    <script src="/src/utilities/functions/barrier.js"></script>
    <script src="/src/sketching/plugins/playback_alt.js"></script>
</head>
<body style="background:#FFFFFF;">
<div style="display:flex;">
    <user-action-graph id="hello" style="height:100%; width:50%; border: 5px solid blue; right"></user-action-graph>
    <sketch-surface id="fakeCanvas" style="height:100%; width:50%; border: 5px solid red;"></sketch-surface>
</div>
<script>
    //fakeCanvas
    var surface = document.body.querySelector("sketch-surface");
    var graphics = surface.graphics;
    var updateManager, safeManager;
    var updateList = [];
    var playBack;
    function primeMe() {
        graphics = surface.graphics;
        var tempList = surface.getUpdateList();
        for (var i = 0; i < tempList.length; i++) {
            updateList.push(tempList[i]);
        }
        updateManager = surface.getUpdateManager();
        safeManager = updateManager;
        //updateManager.clearUpdates(false);
    }

    function playMeSetup() {
        updateManager = surface.getUpdateManager();
        var copyList = [];
        for (var i = 0; i < updateList.length; i++) {
            copyList.push(updateList[i]);
        }
        console.log(copyList);
        updateManager.clearUpdates(false, true);

        playBack = new Playback(copyList, updateManager, graphics);
        updateManager.addPlugin(playBack);
    }

    function playMe(target) {
        playBack.playNext(target+1);
    }

    function graphMe() {
        //userActionGraph
        /*var updateList = new UpdateManager(undefined, function(error) {
            console.log(error);
        });*/
        var updates = safeManager;

        /*
        //begin creating test data
        var stubs = function(){
            return false;
        }

        CourseSketch.PROTOBUF_UTIL.getSrlCommandClass().addRedoMethod(CourseSketch.PROTOBUF_UTIL.CommandType.ASSIGN_ATTRIBUTE, stubs);
        CourseSketch.PROTOBUF_UTIL.getSrlCommandClass().addUndoMethod(CourseSketch.PROTOBUF_UTIL.CommandType.ASSIGN_ATTRIBUTE, stubs);

        var assignAt = CourseSketch.PROTOBUF_UTIL.createBaseCommand(CourseSketch.PROTOBUF_UTIL.CommandType.ASSIGN_ATTRIBUTE, true);
        var assignUpdate = CourseSketch.PROTOBUF_UTIL.createUpdateFromCommands([ assignAt ]);

        updateList.addUpdate(assignUpdate);
        updateList.addUpdate(assignUpdate);
        updateList.addUpdate(assignUpdate);
        updateList.undoAction(false);
        updateList.undoAction(false);
        updateList.redoAction(false);
        updateList.undoAction(false);
        updateList.redoAction(false);
        updateList.addUpdate(assignUpdate);
        updateList.undoAction(false);
        updateList.redoAction(false);
        updateList.addUpdate(assignUpdate);*/

        var updateData = CourseSketch.PROTOBUF_UTIL.SrlUpdateList();
        //updateData.list=(updates.getUpdateList());
        updateData.list= updateList;
        console.log(updateData);
        //end creating test data

        var userGraph = document.body.querySelector("user-action-graph");
        userGraph.loadData(updateData);
    }


</script>
</body>
</html>
