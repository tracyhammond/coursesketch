<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Welcome!</title>
<script type="text/javascript" src="js/utils/loadingManager.js"></script>
<script type="text/javascript" src="js/utils/utilityFunctions.js"></script>

<!-- login element -->
<link rel="import" href="/src/connection/login/loginInclude.html">

<!-- protobuf -->
<link rel="import" href="/src/utilities/includes/protobufInclude.html">

<!-- Jquery library -->
<link rel="import"
	href="/src/utilities/libraries/jquery/jqueryInclude.html">

<link rel="icon" type="image/ico" href="images/CSpencil.ico">
<style>
html,body {
	margin: 0px;
	padding: 0px;
	border: 0px;
	width: 100%;
	height: 100%;
}

body {
	background: #EDEEEF;
}
</style>
<script>
    var connection = false;

    function Redirector(scope) {
        var scope = scope;
        var activeState = false;
        /**
        Sets the hash url to the file location.
        
        This allows us to find the url if something were to happen.
         */
        this.setRedirect = function setRedirect(url) {
            var shortUrl = replaceAll('html', '', url); // Remove html from file ending
            var hashUrl = replaceAll('/', '.', shortUrl);
            var trimmedHash = hashUrl.substring(1, hashUrl.length - 1); // Trim ending
            var replacedHash = ('' + window.location).split('#')[0] + '#' + trimmedHash;
            scope.location.replace(replacedHash);
        }

        function replaceAll(find, replace, str) {
            return str.replace(new RegExp(find, 'g'), replace);
        }

        this.getRedirect = function getRedirect() {
            var starting = scope.location.hash.substring(1);
            var addedSlashes = 'html/' + replaceAll('\\.', '/', starting) + '.html';
            return addedSlashes;
        }

        this.moveWindow = function(url) {
            document.getElementById('iframeContent').src = url;
        }
    }
    var redirector = new Redirector(window);
    $(document).ready(function() {
        window.addEventListener("beforeunload", function(e) {
            var r = PROTOBUF_UITL.Request();
            r.setRequestType(Request.MessageType.CLOSE);
            connection.sendRequest(r);
            return "you can close this window";
        });

        var login = document.createElement("login-system");
        login.setOnSuccessLogin(function() {

        });

        var element = document.querySelector("#loginLocation");
        element.appendChild(login);

        element.style.display = "block";
    });
</script>
</head>
<body>
	<!-- 
	<iframe id="iframeContent" width="100%" height="100%" frameborder="0"
		src="html/login/login.html" style="display: none"></iframe>
		 -->
	<div id="loginLocation" style="display: none"></div>
</body>
</html>