<!DOCTYPE html>
<html>
<base href="../../">
  	<link rel="stylesheet" href="css/utility/columns.css">
	<script type="text/javascript" src="js/input/drawing.js"></script>
	<script type="text/javascript" src="js/SRL/SRL_Library.js"></script>
	<script type="text/javascript" src="js/input/touch_event.js"></script>
	<script type="text/javascript" src="js/SRL/SRL_Graphics.js"></script>
    <link rel="icon" type="image/ico" href="images/CSpencil.ico">
    <script type="text/javascript">
    	function init() {
    		parent.redirector.setRedirect('html/drawing/drawing.html');
    		initializeInput();
    		matchParent('drawingCanvas');
    	}
		var serverConnection = parent.connection;
		var drawingCreator = false;
		var sketch = false;
		var canvasContext = false;
	    function initializeInput() {
			var input = new inputListener();
			input.initializeCanvas("drawingCanvas");
			canvasContext = input.canvasContext;
			sketch = new sketchContainer();
			drawingCreator = new drawingInputCreator(input, sketch, callback, canvasContext);
			serverConnection.setOnMessageListener(function(evt, message) {
				alert('I AM GETTING A MESSAGE');
			});
		}
	    
	    function callback() {
			element = document.getElementById('output');
			var html = "";
			var list = sketch.getList();
			for(var i = 0; i < list.length; i++) {
				var object = list[i];
				object.draw(canvasContext);
			}
		//	alert(serverConnection.sendRequest);
			//var Message = parent.Message;
		//	alert(parent.Request);
			serverConnection.sendRequest(new parent.Request());
		//	element.innerHTML = html;
		}
	    
	    function setUpProtobufInheritance() {
	    	parent.SRL_Shape.prototype = new SRL_Shape();
	    	parent.SRL_Stroke.prototype = new SRL_Stroke();
	    	parent.SRL_Point.prototype = new SRL_Point();
	    	SRL_Shape = parent.SRL_Shape;
	    	SRL_Stroke = parent.SRL_Stroke;
	    	SRL_Point = parent.SRL_Point;
	    }
	    //setUpProtobufInheritance();
	</script>
	<script type="text/javascript">
			parent.addScopedLoadEvent(window, function() {
	  				matchParent('drawingCanvas');
	  		});

			window.onresize = function() {
					matchParent('drawingCanvas');
				}

	  		function matchParent(id) {
	  			var body = document.body,
			    html = document.documentElement;
				var height = window.innerHeight - 4;
				var width = window.innerWidth - 4;
				var element = document.getElementById('drawingCanvas');
				element.height = height;
				element.width = width;
				element.style.width = element.width;
				element.style.height = element.height;
	  		}
	  		
	  		
	</script>
	<style>
	html, body {
	    margin: 0px;
	    padding: 0px;
	    border: 0px;
	}
	</style>
</head>
<body onload="init()">
		<canvas id="drawingCanvas" width="800" height="600" style="top:0px; left:0px; width: 800; height: 100%; background:#FFFFFF;"></canvas>
</body>