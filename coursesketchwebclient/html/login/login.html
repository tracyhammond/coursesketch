<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <base href="../../">
        <title>Course Sketch</title>
        <script type="text/javascript" src="js/connection/connection_library.js"></script>
    	<script type="text/javascript" src="js/utils/loadingManager.js"></script>
        <link rel="stylesheet" type="text/css" href="css/login/introForms.css" />
       <link rel="icon" 
            type="image/ico" 
            href="/images/CSpencil.ico" />   
		<script type='text/javascript'>
            function init() {
            	setup();
            }

			//called when login button is pressed
            function formSubmit() {
				function sendLogin(arg1, arg2, arg3) {
					alert(arg3);
	  				var request = new Request(Request.MessageType.LOGIN);
	  				var loginInfo = new LoginInformation(arg1, arg2, false, arg3, "");
	  				request.login = loginInfo;
	  				connection.sendRequest(request);
	  			}
				sendLogin(document.getElementById("username").value, document.getElementById("password").value, document.getElementById("instructorIntent").checked);
            }

            function setup() {
            	connection = parent.connection;
            	copyProtosFromParentProtos();
	  			function onOpen(evt) {
	  			}

	  			function onClose(evt) {
	  				// logout.
	  				if (evt.code == CONNECTION_LOST) {
	  					alert('can not connect to the server');
	  				} else if(evt.code == SERVER_FULL) {
	  					alert(evt.reason);
	  				} else if(evt.code == INCORRECT_LOGIN) {
	  					alert(evt.reason);
	  				}
	  			}

	  			function onMessage(evt, message) {
	  				if (message.login.isLoggedIn) {
	  					// Redirect to main.html
	  					parent.connection = connection;
	  					parent.location.hash = "main"; // tells url to go to main page (for re-redirects?)
	  					window.location.assign("/main.html");
	  				} else {
	  					alert(message.responseText);
	  				}
	  			}

	  			function onError(evt, error) {
	  				// through an uhoh oreo.
	  				alert('OMG AN ERROR ' + error);
	  			}
	  			connection.setListeners(onOpen, onClose, onMessage, onError);
	  		}
	  		var connection = false;
        </script>
    </head>
    <body onload="init();">
        <div class="container">
          <section id="content">
            <!-- Login Form: Username and Password field. Checks with Middle for confirmation -->
            <div id="form">
                <form onsubmit="return false">
                    <h1>CourseSketch</h1>
                    <div id="user">
                        <input type="text" name="username" placeholder="Username" required="" id="username" />
                    </div>
                    <div id="user">
                        <input type="password" name="password" placeholder="Password" required="" id="password" />
                    </div>
                    <div id="user">
                        <input type="checkbox" name="instructorIntent" id="instructorIntent" />Log on as an Instructor?
                    </div>
                    <div>
    					<input type="submit" onclick="formSubmit()" value="Login">
    					<a href="recovery.php">Lost your password?</a>
                    </div>
                </form>
            </div>
            <div class="button" >
                <a href="register.php">Register</a>
            </div>
          </section>
        </div>
    </body>
</html>
